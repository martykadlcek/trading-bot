## What is daily performance log

Every day on 0:00 UTC, all profit and loss from all live traders are collected into single row in the daily performance log, which is accesible in statistics page under the same
named section. 

The statistics are collected for all live traders, simulators and paper trading is not used, unless the option "ignore_simulator" is specified in the configuration (section "report")

Daily performance log is stored locally in the folder "data" by default. However, it is
possible to export the data to any database or other storage for futher processing. These data can be exported live after every trade is recorded. This feature is called "external  performance log".

## How to enabl external performance log

To enable external performance log, you need to specify option in the mmbot.conf in the section "report"

```
daily_report_service=<command line>
```

The command line specified script, which processes the events generated after every trade. The communication protocol is very similar to communication protocol of the broker. The communication is routed through **stdin** and **stdout** where each command is on separate line. Commands and responses are JSON arrays. The communication is synchronous, request-response style.

## Commands

Altough it was written that every command must be on single line, formatted JSON is used 
in the following documentation for the easy reading purpose.

### sendItem

```
["sendItem",{
	"broker":"string",
	"currency":"string",
	"asset":"string",
	"magic":number
	"price":number,
	"size":number,
	"tradeId":"any",
	"uid":number,
	"change":number
	}]
```

Command is send after each trade. 

* **broker** - contains name of the broker, how it is named in brokers.conf (i.e. poloniex)
* **currency** - contains trade's currency (reported by the broker)
* **magic** - contains random number, which identifies the trader. Magic is derived from traders identifier.
* **price** - contains price of the trade
* **size** - contains size of the trade
* **tradeId** - contains UID of the trade 
* **uid** - contains random UID of the trader, which is generated by the bot.
* **change** - contains change of value of the account in the **currency**. This value represents change of profit or loss made by specified trader by specified trade.  

**Return value**

```
[ true ]
```

## genReport

```
["genReport", "number"]
```

Called to generate report which is available for use in Daily Performance Report section. Request is send several times during the day, but not each minute, because it is expected, that report doesn't change during the day - so it is cached. It is always called after robot's restart.

The parameter contains **dayIndex** which is calculated as `linux_timestamp/86400`.  

**Return value**

```
[true, {
	"hdrs":["Date","string",....],
	"rows":[ [timestamp, number,number,...],...],
	"sums":[number,number,...]
	}]
```

Return value contains a table of numbers. 
* **hdrs** - contains title of each column. The "Date" collumn must be included (can have any arbitrary text)
* **rows** - contains rows of the table. Each rows must have exact same columns. First column contains timestamp of the row (only date is used).
* **sums** - contains sums for each row, **excluding the date column** (so the array has one field less than others)

